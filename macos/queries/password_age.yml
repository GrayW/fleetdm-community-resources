- name: Password Age
  description: Displays the age of the password for the current user in days.
  query: |
    SELECT 
      CAST((strftime('%s','now') - account_policy_data.password_last_set_time) / 86400 AS INTEGER) AS "Days since last password change", 
      (SELECT username FROM users WHERE directory LIKE '/Users/%' ORDER BY uid LIMIT 1) AS primary_user
    FROM 
      account_policy_data
    INNER JOIN 
      users 
    ON 
      account_policy_data.uid = users.uid
    WHERE 
      (strftime('%s','now') - account_policy_data.password_last_set_time) / 86400 > 0;
  platform: darwin
  interval: 3600 # runs hourly
  observer_can_run: true
  automations_enabled: true